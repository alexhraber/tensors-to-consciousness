services:
  explorer:
    build:
      context: .
      dockerfile: Dockerfile
    image: tensors-to-consciousness:dev
    working_dir: /workspace
    stdin_open: true
    tty: true
    environment:
      TERM: ${TERM:-xterm-256color}
      COLORTERM: ${COLORTERM:-truecolor}
    volumes:
      - ./:/workspace
      - t2c_config:/workspace/.config

  explorer-gpu:
    profiles: ["gpu"]
    build:
      context: .
      dockerfile: Dockerfile
    image: tensors-to-consciousness:dev
    working_dir: /workspace
    stdin_open: true
    tty: true
    gpus: all
    devices:
      - /dev/dri:/dev/dri
    environment:
      TERM: ${TERM:-xterm-256color}
      COLORTERM: ${COLORTERM:-truecolor}
      NVIDIA_VISIBLE_DEVICES: ${NVIDIA_VISIBLE_DEVICES:-all}
      NVIDIA_DRIVER_CAPABILITIES: ${NVIDIA_DRIVER_CAPABILITIES:-compute,utility,graphics}
    volumes:
      - ./:/workspace
      - t2c_config:/workspace/.config

volumes:
  t2c_config:
